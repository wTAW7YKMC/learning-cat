(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[885],{8810:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/timer",function(){return r(8578)}])},8578:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return g}});var s=r(5893),a=r(7294),n=r(1163);r(1649);var i=r(4318),o=r(8387);let c=(0,o.Z)("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),l=(0,o.Z)("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]),u=(0,o.Z)("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),d=(0,o.Z)("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),h=(0,o.Z)("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]]);var p=r(3550),x=function(e,t){return(x=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function m(e){var t,r,s,n,i,o,c,l=e.className,u=e.counterClockwise,d=e.dashRatio,h=e.pathRadius,p=e.strokeWidth,x=e.style;return(0,a.createElement)("path",{className:l,style:Object.assign({},x,(r=(t={pathRadius:h,dashRatio:d,counterClockwise:u}).counterClockwise,n=(1-t.dashRatio)*(s=2*Math.PI*t.pathRadius),{strokeDasharray:s+"px "+s+"px",strokeDashoffset:(r?-n:n)+"px"})),d:"\n      M 50,50\n      m 0,-"+(o=(i={pathRadius:h,counterClockwise:u}).pathRadius)+"\n      a "+o+","+o+" "+(c=i.counterClockwise?1:0)+" 1 1 0,"+2*o+"\n      a "+o+","+o+" "+c+" 1 1 0,-"+2*o+"\n    ",strokeWidth:p,fillOpacity:0})}var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return!function(e,t){function r(){this.constructor=e}x(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(t,e),t.prototype.getBackgroundPadding=function(){return this.props.background?this.props.backgroundPadding:0},t.prototype.getPathRadius=function(){return 50-this.props.strokeWidth/2-this.getBackgroundPadding()},t.prototype.getPathRatio=function(){var e=this.props,t=e.value,r=e.minValue,s=e.maxValue;return(Math.min(Math.max(t,r),s)-r)/(s-r)},t.prototype.render=function(){var e=this.props,t=e.circleRatio,r=e.className,s=e.classes,n=e.counterClockwise,i=e.styles,o=e.strokeWidth,c=e.text,l=this.getPathRadius(),u=this.getPathRatio();return(0,a.createElement)("svg",{className:s.root+" "+r,style:i.root,viewBox:"0 0 100 100","data-test-id":"CircularProgressbar"},this.props.background?(0,a.createElement)("circle",{className:s.background,style:i.background,cx:50,cy:50,r:50}):null,(0,a.createElement)(m,{className:s.trail,counterClockwise:n,dashRatio:t,pathRadius:l,strokeWidth:o,style:i.trail}),(0,a.createElement)(m,{className:s.path,counterClockwise:n,dashRatio:u*t,pathRadius:l,strokeWidth:o,style:i.path}),c?(0,a.createElement)("text",{className:s.text,style:i.text,x:50,y:50},c):null)},t.defaultProps={background:!1,backgroundPadding:0,circleRatio:1,classes:{root:"CircularProgressbar",trail:"CircularProgressbar-trail",path:"CircularProgressbar-path",text:"CircularProgressbar-text",background:"CircularProgressbar-background"},counterClockwise:!1,className:"",maxValue:100,minValue:0,strokeWidth:8,styles:{root:{},trail:{},path:{},text:{},background:{}},text:""},t}(a.Component);function y(e){return Object.keys(e).forEach(function(t){null==e[t]&&delete e[t]}),e}function g(){var e,t,r,o,x,m,g,k,j,b,w,v;let N=(0,n.useRouter)(),{taskId:C}=N.query,[S,P]=(0,a.useState)(null),[_,R]=(0,a.useState)(!0),[E,O]=(0,a.useState)(1500),[Z,B]=(0,a.useState)(1500),[M,D]=(0,a.useState)(!1),[T,W]=(0,a.useState)(!1),[A,I]=(0,a.useState)(!1),[L,z]=(0,a.useState)(0);(0,a.useEffect)(()=>{C?F():R(!1)},[C]),(0,a.useEffect)(()=>{let e;return M&&!T&&E>0&&(e=setInterval(()=>{O(e=>e<=1?(q(),0):e-1)},1e3)),()=>clearInterval(e)},[M,T,E]);let F=async()=>{try{let e=localStorage.getItem("token"),t=await fetch("".concat("http://localhost:3001","/api/tasks/").concat(C),{headers:{Authorization:"Bearer ".concat(e)}}),r=await t.json();if(r.success){P(r.data);let e=60*r.data.estimated_duration;O(e),B(e)}else N.push("/tasks")}catch(e){console.error("获取任务信息失败:",e),N.push("/tasks")}finally{R(!1)}},q=()=>{if(D(!1),A){I(!1),O(Z);let e=confirm("休息结束！是否继续学习？");e&&D(!0)}else{z(L+1);let e=new Audio("/sounds/complete.mp3");e.play(),L%4==3?O(900):O(300),I(!0),D(!0)}},V=async()=>{if(S)try{let e=localStorage.getItem("token"),t=Math.floor((Z-E)/60),r=t>=Z/60*.8?t:0;await fetch("".concat("http://localhost:3001","/api/timer/record"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({taskId:S.task_id,startTime:new Date(Date.now()-6e4*t).toISOString(),endTime:new Date().toISOString(),actualDuration:t,effectiveDuration:r,pomodoroCount:L,isCompleted:r>0})}),r>0&&(alert("\uD83C\uDF89 恭喜完成学习！获得卡片奖励！"),N.push("/tasks"))}catch(e){console.error("保存计时记录失败:",e)}},$=E/Z*100;return _?(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-pink-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"w-8 h-8 border-2 border-purple-600 border-t-transparent rounded-full animate-spin mx-auto"}),(0,s.jsx)("p",{className:"mt-2 text-gray-500",children:"加载中..."})]})}):(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-pink-50 flex items-center justify-center px-4",children:(0,s.jsx)("div",{className:"max-w-lg w-full",children:(0,s.jsxs)("div",{className:"card p-8",children:[S&&(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:S.title}),(0,s.jsxs)("div",{className:"flex justify-center space-x-4 text-sm text-gray-500",children:[(0,s.jsxs)("span",{children:["预计 ",S.estimated_duration," 分钟"]}),(0,s.jsx)("span",{children:"\xb7"}),(0,s.jsx)("span",{children:"easy"===S.difficulty?"简单":"medium"===S.difficulty?"中等":"困难"})]})]}),(0,s.jsx)("div",{className:"flex justify-center mb-8",children:(0,s.jsx)("div",{className:"w-48 h-48",children:(0,s.jsx)(f,{value:$,text:"".concat(Math.floor(E/60).toString().padStart(2,"0"),":").concat((E%60).toString().padStart(2,"0")),styles:(t=(e={strokeLinecap:"round",textSize:"16px",pathColor:A?"#10B981":"#8B5CF6",textColor:A?"#10B981":"#8B5CF6",trailColor:"#E5E7EB",backgroundColor:"#8B5CF6"}).rotation,r=e.strokeLinecap,o=e.textColor,x=e.textSize,m=e.pathColor,g=e.pathTransition,k=e.pathTransitionDuration,j=e.trailColor,b=e.backgroundColor,{root:{},path:y({stroke:m,strokeLinecap:r,transform:w=null==t?void 0:"rotate("+t+"turn)",transformOrigin:v=null==t?void 0:"center center",transition:g,transitionDuration:null==k?void 0:k+"s"}),trail:y({stroke:j,strokeLinecap:r,transform:w,transformOrigin:v}),text:y({fill:o,fontSize:x}),background:y({fill:b})})})})}),(0,s.jsx)("div",{className:"text-center mb-8",children:A?(0,s.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-green-600",children:[(0,s.jsx)(h,{className:"w-5 h-5"}),(0,s.jsx)("span",{className:"font-medium",children:"休息时间"})]}):M?(0,s.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-purple-600",children:[(0,s.jsx)(p.Z,{className:"w-5 h-5"}),(0,s.jsx)("span",{className:"font-medium",children:"专注学习中"})]}):(0,s.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-gray-500",children:[(0,s.jsx)(i.Z,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:"准备开始"})]})}),(0,s.jsx)("div",{className:"flex justify-center space-x-4",children:M?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("button",{onClick:()=>{W(!T)},className:"flex items-center space-x-2 px-6 py-3 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition-colors",children:[(0,s.jsx)(l,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:T?"继续":"暂停"})]}),(0,s.jsxs)("button",{onClick:()=>{D(!1),W(!1),O(Z),V()},className:"flex items-center space-x-2 px-6 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors",children:[(0,s.jsx)(u,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:"结束"})]}),(0,s.jsxs)("button",{onClick:()=>{D(!1),W(!1),O(Z),I(!1)},className:"flex items-center space-x-2 px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:[(0,s.jsx)(d,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:"重置"})]})]}):(0,s.jsxs)("button",{onClick:()=>{D(!0),W(!1)},className:"flex items-center space-x-2 px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[(0,s.jsx)(c,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:"开始"})]})}),L>0&&(0,s.jsxs)("div",{className:"mt-8 text-center text-sm text-gray-500",children:["已完成 ",L," 个番茄钟"]}),(0,s.jsx)("div",{className:"mt-8 text-center",children:(0,s.jsx)("button",{onClick:()=>N.push("/tasks"),className:"text-purple-600 hover:text-purple-700 text-sm",children:"返回任务列表"})})]})})})}r(7743),g.requireAuth=!0},7743:function(){},8387:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var s=r(7294),a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();var i=(e,t)=>{let r=(0,s.forwardRef)(({color:r="currentColor",size:i=24,strokeWidth:o=2,absoluteStrokeWidth:c,children:l,...u},d)=>(0,s.createElement)("svg",{ref:d,...a,width:i,height:i,stroke:r,strokeWidth:c?24*Number(o)/Number(i):o,className:`lucide lucide-${n(e)}`,...u},[...t.map(([e,t])=>(0,s.createElement)(e,t)),...(Array.isArray(l)?l:[l])||[]]));return r.displayName=`${e}`,r}},4318:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});var s=r(8387);let a=(0,s.Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},3550:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});var s=r(8387);let a=(0,s.Z)("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]])}},function(e){e.O(0,[774,888,179],function(){return e(e.s=8810)}),_N_E=e.O()}]);